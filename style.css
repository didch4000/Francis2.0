body {
    font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    background-color: #3a3a3a;
    color: #eee;
    margin: 0;
    /* MODIFICATION : On déplace overflow: hidden vers .app-wrapper pour un meilleur contrôle sur mobile */
}

.app-wrapper {
    display: flex;
    flex-direction: column;
    height: 100vh;
    width: 100vw;
    overflow: hidden; /* MODIFICATION : Empêche le débordement au niveau de l'application principale */
}

/* Barre d'outils (Haut) */
.toolbar {
    flex-shrink: 0;
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 8px 20px;
    background-color: #252526;
    border-bottom: 1px solid #444;
    z-index: 20;
    flex-wrap: wrap; /* MODIFICATION : Permet aux groupes d'outils de passer à la ligne sur les petits écrans */
}
.tool-group { display: flex; align-items: center; gap: 8px; }
.tool-group button, .tool-group select, .tool-group input, .tool-group span {
    background: #3c3c3c;
    border: 1px solid #555;
    color: #ccc;
    cursor: pointer;
    border-radius: 4px;
    padding: 5px 10px;
    font-size: 14px;
    display: flex;
    align-items: center;
    justify-content: center;
}

/* Styles pour les boutons désactivés */
.tool-group button:disabled {
    background: #2a2a2a;
    border: 1px solid #444;
    color: #666;
    cursor: not-allowed;
    opacity: 0.5;
}

/* Styles pour les boutons actifs/disponibles */
.tool-group button:not(:disabled) {
    background: #3c3c3c;
    border: 1px solid #555;
    color: #eee;
    cursor: pointer;
    opacity: 1;
}

/* Hover pour les boutons actifs */
.tool-group button:not(:disabled):hover {
    background: #4a4a4a;
    border-color: #666;
}
#dash-spacing-container {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    padding: 0;
    border: none;
    background: transparent;
}
.tool-group input[type="color"] { padding: 2px; height: 28px; }
#zoom-level-display {
    min-width: 80px;
    height: 30px;
    line-height: 20px;
    text-align: center;
    cursor: default;
    user-select: none;
    transition: background-color 0.2s;
    position: relative;
    box-sizing: border-box;
}
#zoom-level-display.switchable {
    cursor: pointer;
}
#zoom-level-display.switchable:hover {
    background-color: #555;
}
#zoom-level-display input {
    width: 100%;
    height: 100%;
    position: absolute;
    top: 0;
    left: 0;
    background: #1e1e1e;
    border: 1px solid #007acc;
    color: #eee;
    text-align: center;
    box-sizing: border-box;
    padding: 0;
    font-size: 14px;
}

.tool.active, button.active {
    background-color: #007acc;
    border-color: #007acc;
    color: white;
}
/* Styles généraux pour boutons désactivés, mais pas pour les outils de projet */
button:disabled:not(#btn-save-project):not(#btn-load-project):not(#btn-new-project) { 
    opacity: 0.4; 
    cursor: not-allowed; 
}

/* Styles spécifiques pour les boutons de projet désactivés */
#btn-save-project:disabled {
    background: #2a2a2a !important;
    border: 1px solid #444 !important;
    color: #666 !important;
    cursor: not-allowed !important;
    opacity: 0.5 !important;
}

/* Styles ultra-spécifiques pour les boutons de projet actifs */
#project-tools #btn-load-project,
#project-tools #btn-load-project:not(:disabled),
body #project-tools #btn-load-project,
html body #project-tools #btn-load-project {
    background-color: #3c3c3c !important;
    background: #3c3c3c !important;
    border: 1px solid #555 !important;
    color: #eee !important;
    cursor: pointer !important;
    opacity: 1 !important;
}

#project-tools #btn-new-project,
#project-tools #btn-new-project:not(:disabled),
body #project-tools #btn-new-project,
html body #project-tools #btn-new-project {
    background-color: #3c3c3c !important;
    background: #3c3c3c !important;
    border: 1px solid #555 !important;
    color: #eee !important;
    cursor: pointer !important;
    opacity: 1 !important;
}

#project-tools #btn-save-project:not(:disabled),
body #project-tools #btn-save-project:not(:disabled),
html body #project-tools #btn-save-project:not(:disabled) {
    background-color: #3c3c3c !important;
    background: #3c3c3c !important;
    border: 1px solid #555 !important;
    color: #eee !important;
    cursor: pointer !important;
    opacity: 1 !important;
}

/* Animation pour forcer le recalcul du navigateur */
@keyframes project-buttons-force {
    0% { opacity: 0.999; }
    100% { opacity: 1; }
}

.permanent-tools {
    display: flex !important;
    visibility: visible !important;
    opacity: 1 !important;
    position: relative !important;
    order: 3 !important; /* Assure que les boutons projet apparaissent après Vue mais avant les options dynamiques */
}

/* Groupes d'options dynamiques positionnés après les boutons projet */
.options-group {
    order: 10 !important; /* S'affiche après les boutons projet */
}

/* Outils d'export toujours à droite */
#export-tools {
    order: 99 !important;
    margin-left: auto !important;
}

.permanent-tools button {
    animation: project-buttons-force 0.1s ease-in-out;
}

/* Styles avec la spécificité maximale absolue */
html body div.toolbar div.permanent-tools#project-tools button#btn-load-project,
html body div.toolbar div.permanent-tools#project-tools button#btn-new-project,
html body div.toolbar div.permanent-tools#project-tools button#btn-save-project:not(:disabled) {
    background-color: #3c3c3c !important;
    background-image: none !important;
    background: #3c3c3c !important;
    border: 1px solid #555 !important;
    border-color: #555 !important;
    color: #eee !important;
    cursor: pointer !important;
    opacity: 1 !important;
    filter: none !important;
    transform: none !important;
}

.tool-group.disabled, .tool-group.disabled > * {
    opacity: 0.4;
    cursor: not-allowed;
    pointer-events: none;
}
.tool-group.disabled button, .tool-group.disabled select, .tool-group.disabled input {
    pointer-events: none;
}

/* Le groupe instructions-group et son bouton doivent toujours être actifs */
.instructions-group,
.instructions-group *,
.instructions-group button {
    opacity: 1 !important;
    cursor: pointer !important;
    pointer-events: auto !important;
}

#btn-instructions {
    background: #3c3c3c !important;
    border: 1px solid #555 !important;
    color: #eee !important;
}

#btn-instructions:hover {
    background: #4a4a4a !important;
    border-color: #666 !important;
}

/* S'assurer que le groupe instructions ne soit jamais considéré comme disabled */
.instructions-group.disabled,
.instructions-group.disabled *,
.instructions-group.disabled button {
    opacity: 1 !important;
    cursor: pointer !important;
    pointer-events: auto !important;
}


/* Zone de dessin (Centre) */
#canvas-container {
    flex-grow: 1;
    position: relative;
    overflow: auto;
    z-index: 1000; /* S'assurer que le curseur reste visible au-dessus de tout */
    display: flex;
    background-color: #3a3a3a;
    background-image: 
        linear-gradient(45deg, #444 25%, transparent 25%), 
        linear-gradient(-45deg, #444 25%, transparent 25%),
        linear-gradient(45deg, transparent 75%, #444 75%),
        linear-gradient(-45deg, transparent 75%, #444 75%);
    background-size: 20px 20px;
    background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
    /* AJOUT : Empêche le navigateur de faire défiler la page lors d'une interaction tactile sur le canevas */
    touch-action: none;
}

#scroll-content {
    position: relative;
    margin: auto;
}

#zoom-wrapper {
    position: absolute;
    top: 0;
    left: 0;
    transform-origin: 0 0;
}

#canvas-container .canvas-wrapper {
    position: absolute;
    top: 0;
    left: 0;
    box-shadow: 0 5px 25px rgba(0,0,0,0.4);
}
#guide-message {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
    color: #aaa;
    background: rgba(42, 42, 42, 0.75);
    padding: 25px 35px;
    border-radius: 10px;
    z-index: 10000;
    pointer-events: none;
    border: 2px solid #555;
    box-shadow: 0 8px 25px rgba(0,0,0,0.7);
    max-width: 400px;
    min-width: 320px;
    backdrop-filter: blur(5px);
}
#guide-message h2 {
    margin-top: 0;
    margin-bottom: 10px;
    color: #00aaff;
    font-size: 1.2em;
    font-weight: 600;
}

#guide-message p {
    margin-bottom: 0;
    line-height: 1.4;
    font-size: 1em;
}


.layer-move-cursor { cursor: move; }
.text-cursor { cursor: text; }
.fill-cursor { cursor: crosshair; }
.pan-cursor { cursor: grab; }
.panning-cursor { cursor: grabbing; }

/* Styles pour la vue web */
#webview-container {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 50;
    background-color: #3a3a3a;
}
#webview-frame {
    width: 100%;
    height: 100%;
    border: none;
}
#btn-close-webview {
    position: absolute;
    top: 10px;
    right: 10px;
    z-index: 51;
    padding: 8px 15px;
    background-color: #007acc;
    border: 1px solid #005fa3;
    color: white;
    border-radius: 5px;
    cursor: pointer;
    font-size: 14px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.5);
}
#btn-close-webview:hover {
    background-color: #005fa3;
}



/* Styles pour la Fenêtre Modale */
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.4);
    backdrop-filter: blur(5px);
    /* AJOUT : Permet le défilement de la modale elle-même si son contenu est trop grand */
    overflow-y: auto;
}
.modal-content {
    background-color: #2c2c2c;
    margin: 5% auto;
    padding: 20px;
    border: 1px solid #555;
    border-radius: 8px;
    width: 90%;
    max-width: 1200px;
    height: 85%;
    display: flex;
    flex-direction: column;
}
.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid #444;
    padding-bottom: 15px;
    margin-bottom: 15px;
}
.modal-header h2 { margin: 0; }
.close-button {
    color: #aaa;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
}
.close-button:hover, .close-button:focus { color: #fff; }
.modal-body {
    overflow-y: auto;
    flex-grow: 1;
}
#signs-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
    gap: 15px;
}
.sign-item {
    background-color: #3f3f3f;
    padding: 10px;
    border-radius: 5px;
    cursor: pointer;
    transition: transform 0.2s ease, background-color 0.2s ease;
    display: flex;
    justify-content: center;
    align-items: center;
}
.sign-item:hover {
    transform: scale(1.1);
    background-color: #555;
}
.sign-item img {
    max-width: 100%;
    max-height: 80px;
}

.sign-item.add-custom-sign {
    border: 2px dashed #777;
    font-size: 48px;
    font-weight: bold;
    color: #aaa;
    line-height: 80px;
}
.sign-item.add-custom-sign:hover {
    background-color: #4a4a4a;
    color: #fff;
    border-color: #007acc;
}
.sign-item.add-custom-sign label {
    width: 100%;
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
}

/* Styles pour la modale d'ajout de calque */
.add-layer-options {
    display: flex;
    flex-direction: column;
    gap: 20px;
    padding: 20px 0;
}
.add-layer-options button {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 15px;
    padding: 20px;
    font-size: 18px;
    background-color: #3f3f3f;
    border: 1px solid #555;
    color: #eee;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.2s;
}
.add-layer-options button:hover {
    background-color: #555;
    border-color: #007acc;
}
.add-layer-options button .icon {
    font-size: 24px;
}



/* Styles pour les modales de formulaire */
#scale-modal .modal-body .form-group,
#landmark-modal .modal-body .form-group {
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 10px;
}
#scale-modal .modal-body label,
#landmark-modal .modal-body label {
    min-width: 180px;
}
#scale-modal .modal-body input[type="number"],
#scale-modal .modal-body input[type="checkbox"],
#landmark-modal .modal-body input[type="number"] {
    padding: 8px;
    background-color: #3f3f3f;
    border: 1px solid #555;
    color: #eee;
    border-radius: 4px;
}
#scale-modal .modal-body input[type="checkbox"] {
    width: auto;
    margin-right: 5px;
}
#scale-modal .modal-body button,
#landmark-modal .modal-body button,
#legend-modal .modal-body button {
    padding: 10px 15px;
    background-color: #007acc;
    border: none;
    color: white;
    border-radius: 4px;
    cursor: pointer;
    display: block;
    margin-top: 20px;
    width: 100%;
}
#scale-modal .modal-body button:hover,
#landmark-modal .modal-body button:hover,
#legend-modal .modal-body button:hover {
    background-color: #005fa3;
}

#legend-modal .modal-body textarea {
    padding: 8px;
    background-color: #3f3f3f;
    border: 1px solid #555;
    color: #eee;
    border-radius: 4px;
    font-family: inherit;
    font-size: 14px;
    resize: vertical;
}


/* Panneau des calques (Bas) */
.layers-panel {
    flex-shrink: 0;
    background: #252526;
    border-top: 1px solid #444;
    padding: 8px 15px;
    display: flex;
    align-items: center;
    gap: 20px;
    z-index: 10;
    /* AJOUT : Permet au contenu de passer à la ligne si nécessaire */
    flex-wrap: wrap;
}
.separator { width: 1px; height: 25px; background: #555; }
#layers-list {
    list-style: none; padding: 0; margin: 0; display: flex;
    gap: 10px; overflow-x: auto; flex-grow: 1;
    height: 115px; 
    align-items: center;
}
.layer-item {
    flex-shrink: 0; 
    width: 320px; 
    height: 100px; 
    display: flex; 
    flex-direction: row;
    align-items: center; 
    padding: 8px; 
    border: 2px solid #555; 
    border-radius: 5px;
    background-color: #4a4a4a; 
    cursor: pointer; 
    gap: 10px;
}
.layer-item.active { border-color: #007acc; }

.layer-preview {
    width: 180px; 
    height: 100%; 
    flex-shrink: 0; 
    background-color: white;
    background-size: contain; 
    background-position: center; 
    background-repeat: no-repeat;
    border-radius: 3px; 
    position: relative;
}
.layer-controls-icons {
    position: absolute; 
    top: 4px; 
    right: 4px; 
    display: flex; 
    gap: 4px;
    background: rgba(0,0,0,0.5); 
    padding: 3px; 
    border-radius: 5px;
}
.layer-icon { 
    font-size: 1.2em; 
    color: white; 
    cursor: pointer; 
    padding: 0 2px; 
}
.layer-icon:hover { color: #ffc107; }
.layer-info {
    flex-grow: 1; 
    display: flex; 
    flex-direction: column;
    justify-content: space-between; 
    height: 100%; 
    overflow: hidden;
}
.layer-meta { 
    display: flex; 
    align-items: center; 
    gap: 5px; 
    width: 100%; 
}
.layer-item .name {
    flex-grow: 1; 
    white-space: nowrap; 
    overflow: hidden;
    text-overflow: ellipsis; 
    font-size: 0.9em; 
    text-align: left; 
    color: #ddd;
}
.layer-item .visibility { 
    font-size: 1.2em; 
    cursor: pointer; 
}
.opacity-control, .rotation-control { 
    width: 100%; 
    font-size: 0.8em; 
    color: #aaa;
    margin-top: 2px;
}
.opacity-control input[type="range"] { 
    width: 100%; 
    height: 10px; 
    margin-top: 1px; 
}
.rotation-input {
    width: 60px;
    background: #3c3c3c;
    border: 1px solid #555;
    color: #ccc;
    border-radius: 4px;
    padding: 2px 5px;
    font-size: 12px;
    text-align: right;
}
.landmark-visibility-control {
    display: flex;
    align-items: center;
    gap: 4px;
}

#selection-box {
    position: absolute;
    border: 2px dashed #00aaff;
    background-color: rgba(0, 170, 255, 0.2);
    z-index: 1010;
    pointer-events: none;
}

/* AJOUT : Styles pour le mode Plein Écran */
body.fullscreen-active .app-wrapper {
    /* En mode plein écran, le wrapper ne doit plus rien cacher */
    overflow: visible;
}

body.fullscreen-active #canvas-container {
    /* Le canevas prend toute la place de la fenêtre */
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    z-index: 900; /* Niveau élevé mais sous les modales */
}

body.fullscreen-active .layers-panel {
    position: fixed;
    bottom: 0; /* Positionné en bas */
    left: 0;
    right: 0;
    width: 100%;
    box-sizing: border-box;
    z-index: 910;
    transition: opacity 0.4s ease, transform 0.4s ease;
    transform: translateY(0);
    opacity: 1;
    border-radius: 10px 10px 0 0; /* Coins arrondis en haut */
    box-shadow: 0 -2px 10px rgba(0,0,0,0.5);
    border-top: 1px solid #555;
}

body.fullscreen-active .toolbar {
    /* La barre d'outils devient flottante et se place en haut */
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    width: 100%;
    box-sizing: border-box; /* Important pour que le padding ne s'ajoute pas à la largeur */
    z-index: 910; /* Au-dessus du canevas */
    transition: opacity 0.4s ease, transform 0.4s ease;
    transform: translateY(0);
    opacity: 1;
    border-radius: 0 0 10px 10px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.5);
}

body.fullscreen-active .toolbar.hidden {
    /* Style pour cacher la barre d'outils en la faisant glisser vers le haut */
    opacity: 0;
    transform: translateY(-100%);
    pointer-events: none; /* Crucial pour ne pas bloquer les interactions quand elle est invisible */
}

body.fullscreen-active .layers-panel.hidden {
    /* Style pour cacher le panneau des calques en le faisant glisser vers le bas */
    opacity: 0;
    transform: translateY(100%);
    pointer-events: none;
}

/* === CORRECTIONS POUR LES CURSEURS === */

/* IMPORTANT: Réinitialiser les curseurs Fabric.js par défaut */
.canvas-container canvas {
    cursor: inherit !important;
}

/* Forcer l'application des curseurs sur le conteneur principal */
#canvas-container {
    cursor: default;
}

/* === CURSEURS AVEC PRIORITÉ ÉLEVÉE === */

/* Mode sélection */
#canvas-container.select-cursor,
#canvas-container.select-cursor * {
    cursor: default !important;
}

#canvas-container.select-cursor canvas {
    cursor: default !important;
}

/* Mode dessin - ligne */
#canvas-container.draw-cursor,
#canvas-container.draw-cursor *,
#canvas-container.draw-cursor canvas {
    cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 25 25"><line x1="12.5" y1="2" x2="12.5" y2="23" stroke="black" stroke-width="1"/><line x1="2" y1="12.5" x2="23" y2="12.5" stroke="black" stroke-width="1"/><circle cx="12.5" cy="12.5" r="1" fill="black"/></svg>') 12.5 12.5, crosshair !important;
}

/* Mode cercle */
#canvas-container.circle-cursor,
#canvas-container.circle-cursor *,
#canvas-container.circle-cursor canvas {
    cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" fill="none" stroke="black" stroke-width="2"/></svg>') 12 12, crosshair !important;
}

/* Mode courbe */
#canvas-container.curve-cursor,
#canvas-container.curve-cursor *,
#canvas-container.curve-cursor canvas {
    cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="none" stroke="black" stroke-width="2" d="M3 17C3 17 6.5 10 12 10S21 17 21 17"/></svg>') 12 12, crosshair !important;
}

/* Mode remplissage */
#canvas-container.fill-cursor,
#canvas-container.fill-cursor *,
#canvas-container.fill-cursor canvas {
    cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="black" d="M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2ZM21 9V7L15 1H9V3H7V9C7 11.76 9.24 14 12 14S17 11.76 17 9V8H21V9ZM5 16H19V18H5V16ZM5 20H19V22H5V20Z"/></svg>') 12 12, crosshair !important;
}

/* Mode texte */
#canvas-container.text-cursor,
#canvas-container.text-cursor *,
#canvas-container.text-cursor canvas {
    cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="black" d="M5 4V7H10.5V19H13.5V7H19V4H5Z"/></svg>') 12 12, text !important;
}

/* Mode mesure - curseur latte graduée */
#canvas-container.measure-cursor,
#canvas-container.measure-cursor *,
#canvas-container.measure-cursor canvas {
    cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><rect x="2" y="10" width="20" height="4" fill="none" stroke="black" stroke-width="1.5"/><line x1="3" y1="9" x2="3" y2="15" stroke="black" stroke-width="1"/><line x1="6" y1="10.5" x2="6" y2="13.5" stroke="black" stroke-width="1"/><line x1="9" y1="9" x2="9" y2="15" stroke="black" stroke-width="1"/><line x1="12" y1="10.5" x2="12" y2="13.5" stroke="black" stroke-width="1"/><line x1="15" y1="9" x2="15" y2="15" stroke="black" stroke-width="1"/><line x1="18" y1="10.5" x2="18" y2="13.5" stroke="black" stroke-width="1"/><line x1="21" y1="9" x2="21" y2="15" stroke="black" stroke-width="1"/></svg>') 2 9, crosshair !important;
}

/* Mode échelle - curseur latte graduée */
#canvas-container.scale-cursor,
#canvas-container.scale-cursor *,
#canvas-container.scale-cursor canvas {
    cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><rect x="2" y="10" width="20" height="4" fill="none" stroke="black" stroke-width="1.5"/><line x1="3" y1="9" x2="3" y2="15" stroke="black" stroke-width="1"/><line x1="6" y1="10.5" x2="6" y2="13.5" stroke="black" stroke-width="1"/><line x1="9" y1="9" x2="9" y2="15" stroke="black" stroke-width="1"/><line x1="12" y1="10.5" x2="12" y2="13.5" stroke="black" stroke-width="1"/><line x1="15" y1="9" x2="15" y2="15" stroke="black" stroke-width="1"/><line x1="18" y1="10.5" x2="18" y2="13.5" stroke="black" stroke-width="1"/><line x1="21" y1="9" x2="21" y2="15" stroke="black" stroke-width="1"/></svg>') 2 9, crosshair !important;
}

/* Mode ligne de base */
#canvas-container.baseline-cursor,
#canvas-container.baseline-cursor *,
#canvas-container.baseline-cursor canvas {
    cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><line x1="2" y1="12" x2="22" y2="12" stroke="red" stroke-width="3"/><text x="12" y="8" text-anchor="middle" fill="red" font-size="8">LB</text></svg>') 12 12, crosshair !important;
}

/* Mode signalisation */
#canvas-container.crossing-cursor,
#canvas-container.crossing-cursor *,
#canvas-container.crossing-cursor canvas {
    cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><rect x="2" y="8" width="20" height="2" fill="black"/><rect x="2" y="12" width="20" height="2" fill="black"/><rect x="2" y="16" width="20" height="2" fill="black"/></svg>') 12 12, crosshair !important;
}

/* Mode céder le passage - curseur triangle sur pointe */
#canvas-container.yield-cursor,
#canvas-container.yield-cursor *,
#canvas-container.yield-cursor canvas {
    cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><polygon points="12,22 2,4 22,4" fill="none" stroke="black" stroke-width="2"/></svg>') 12 12, crosshair !important;
}

/* Mode trace de freinage */
#canvas-container.skid-mark-cursor,
#canvas-container.skid-mark-cursor *,
#canvas-container.skid-mark-cursor canvas {
    cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path fill="black" d="M2 2L4 6L6 2H8L6 6L8 10L6 14L4 10L2 6L4 2H2ZM10 4L12 8L14 4H16L14 8L16 12L14 16L12 12L10 8L12 4H10Z"/></svg>') 12 12, crosshair !important;
}

/* Mode déplacement de calque */
#canvas-container.layer-move-cursor,
#canvas-container.layer-move-cursor *,
#canvas-container.layer-move-cursor canvas {
    cursor: move !important;
}

/* Mode panoramique */
#canvas-container.pan-cursor,
#canvas-container.pan-cursor *,
#canvas-container.pan-cursor canvas {
    cursor: grab !important;
}

#canvas-container.panning-cursor,
#canvas-container.panning-cursor *,
#canvas-container.panning-cursor canvas {
    cursor: grabbing !important;
}

/* États spéciaux */
#canvas-container.tool-disabled-cursor,
#canvas-container.tool-disabled-cursor *,
#canvas-container.tool-disabled-cursor canvas {
    cursor: not-allowed !important;
}

#canvas-container.loading-cursor,
#canvas-container.loading-cursor *,
#canvas-container.loading-cursor canvas {
    cursor: wait !important;
}

#canvas-container.area-selecting,
#canvas-container.area-selecting *,
#canvas-container.area-selecting canvas {
    cursor: crosshair !important;
}

#canvas-container.drawing,
#canvas-container.drawing *,
#canvas-container.drawing canvas {
    cursor: crosshair !important;
}

/* === CURSEURS PENDANT LES INTERACTIONS === */

/* Surcharge des curseurs Fabric.js pendant la sélection */
#canvas-container.select-cursor .canvas-container:hover {
    cursor: default !important;
}

/* Curseur pendant le survol d'objets en mode sélection */
#canvas-container.select-cursor .upper-canvas:hover {
    cursor: pointer !important;
}

/* Mobile - Curseurs simplifiés */
@media (max-width: 768px) {
    #canvas-container.circle-cursor,
    #canvas-container.circle-cursor *,
    #canvas-container.circle-cursor canvas,
    #canvas-container.curve-cursor,
    #canvas-container.curve-cursor *,
    #canvas-container.curve-cursor canvas,
    #canvas-container.fill-cursor,
    #canvas-container.fill-cursor *,
    #canvas-container.fill-cursor canvas,
    #canvas-container.measure-cursor,
    #canvas-container.measure-cursor *,
    #canvas-container.measure-cursor canvas,
    #canvas-container.scale-cursor,
    #canvas-container.scale-cursor *,
    #canvas-container.scale-cursor canvas,
    #canvas-container.baseline-cursor,
    #canvas-container.baseline-cursor *,
    #canvas-container.baseline-cursor canvas,
    #canvas-container.crossing-cursor,
    #canvas-container.crossing-cursor *,
    #canvas-container.crossing-cursor canvas,
    #canvas-container.yield-cursor,
    #canvas-container.yield-cursor *,
    #canvas-container.yield-cursor canvas,
    #canvas-container.skid-mark-cursor,
    #canvas-container.skid-mark-cursor *,
    #canvas-container.skid-mark-cursor canvas {
        cursor: crosshair !important;
    }
    
    #canvas-container.text-cursor,
    #canvas-container.text-cursor *,
    #canvas-container.text-cursor canvas {
        cursor: text !important;
    }
}

/* Styles pour les contrôles de texte */
.text-style-btn {
    width: 32px !important;
    height: 32px !important;
    font-weight: bold;
    padding: 2px !important;
    min-width: unset;
}

.text-style-btn.active {
    background-color: #0078d4 !important;
    border-color: #0078d4 !important;
}

#font-bold-btn {
    font-weight: 900;
}

#font-italic-btn {
    font-style: italic;
}

#font-underline-btn {
    text-decoration: underline;
}

/* Masquer le panneau de texte par défaut */
#text-options-tools {
    transition: opacity 0.3s ease;
}

/* Styles pour la bulle de guidage */
.guide-tooltip {
    position: fixed;
    z-index: 10001;
    pointer-events: none;
    opacity: 0;
    transform: translateY(-10px);
    transition: all 0.3s ease;
}

.guide-tooltip.show {
    opacity: 1;
    transform: translateY(0);
}

.tooltip-content {
    background: #2c2c2c;
    border: 2px solid #0078d4;
    border-radius: 8px;
    padding: 12px 16px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    position: relative;
    max-width: 280px;
    text-align: center;
}

.tooltip-content p {
    margin: 0;
    color: #ffffff;
    font-size: 14px;
    font-weight: 500;
    line-height: 1.4;
}

.tooltip-arrow {
    position: absolute;
    width: 0;
    height: 0;
    border-left: 10px solid transparent;
    border-right: 10px solid transparent;
    border-top: 10px solid #0078d4;
    bottom: -12px;
    /* left et transform seront définis dynamiquement par JavaScript */
}

.tooltip-arrow::before {
    content: '';
    position: absolute;
    width: 0;
    height: 0;
    border-left: 8px solid transparent;
    border-right: 8px solid transparent;
    border-top: 8px solid #2c2c2c;
    bottom: 2px;
    left: -8px;
}

/* Masquer les contrôles Fabric.js pour certains éléments spécifiques */
.canvas-container .fabric-object[data-name="LB"] .fabric-control,
.canvas-container .fabric-object[data-name="Zero"] .fabric-control {
    display: none !important;
    visibility: hidden !important;
    opacity: 0 !important;
}

/* Corriger l'erreur textBaseline */
* {
    text-baseline: initial !important;
}